<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<!-- <div class="titleblock">
  <h2>Auto Text Scaler</h2>
</div>
<hr /> -->

<div class="buttons top-buttons">
    <button class="btn btn-primary" id="resize">Resize</button>
    <button class="btn btn-secondary" id="cancel">Cancel</button>
</div>

<hr />

<div class="form-check">
  <input class="form-check-input" type="radio" name="autoresizeoptions" id="selection" checked />
  <label class="form-check-label" for="selection">
    Selection
  </label>
</div>
<div class="form-check">
  <input class="form-check-input textbox" type="radio" name="autoresizeoptions" id="text" /> 
  <label class="form-check-label" for="text">
    Textbox Names
  </label>
</div>
<div class="form-check">
  <input class="form-check-input" type="radio" name="autoresizeoptions" id="list-select" /> 
  <label class="form-check-label" for="list-select">
    List
  </label>
</div>

<hr />

<div class="textbox-names-container" style="display: none;">
  <div class="form-group">
    <label for="ids">Enter Textbox Names (comma separated)</label>
    <input class="form-control" type="text" id="ids" placeholder="e.g., Header, Title, Caption" />
  </div>
</div>

<div class="font-size-constraints">
  <!-- <h4>Font Size Constraints (Optional)</h4> -->
  <div class="form-group">
    <label for="minFontSize">Minimum Font Size (pt)</label>
    <input class="form-control" type="number" id="minFontSize" placeholder="Min Font Size" min="0" step="0.5" />
  </div>
  <div class="form-group">
    <label for="maxFontSize">Maximum Font Size (pt)</label>
    <input class="form-control" type="number" id="maxFontSize" placeholder="Max Font Size" min="0" step="0.5" />
  </div>
</div>

<div class="list-select-presets" style="display: none;">
  <!-- <hr />
  <h4>Text Elements</h4> -->
  
  <div class="preset-group">
    <div class="form-group">
      <label>Textbox Name</label>
      <input class="form-control" type="text" id="preset1_name" value="#Display_Name_Line_1" />
    </div>
    <div class="form-row">
      <div class="form-group col-md-6">
        <label>Min Font Size (pt)</label>
        <input class="form-control" type="number" id="preset1_min" value="12" min="0" step="0.5" />
      </div>
      <div class="form-group col-md-6">
        <label>Max Font Size (pt)</label>
        <input class="form-control" type="number" id="preset1_max" value="16" min="0" step="0.5" />
      </div>
    </div>
  </div>
  
  <div class="preset-group">
    <div class="form-group">
      <label>Textbox Name</label>
      <input class="form-control" type="text" id="preset2_name" value="#Display_Name_Line_2" />
    </div>
    <div class="form-row">
      <div class="form-group col-md-6">
        <label>Min Font Size (pt)</label>
        <input class="form-control" type="number" id="preset2_min" value="9" min="0" step="0.5" />
      </div>
      <div class="form-group col-md-6">
        <label>Max Font Size (pt)</label>
        <input class="form-control" type="number" id="preset2_max" value="11" min="0" step="0.5" />
      </div>
    </div>
  </div>
  
  <div class="preset-group">
    <div class="form-group">
      <label>Textbox Name</label>
      <input class="form-control" type="text" id="preset3_name" value="#Display_Name" />
    </div>
    <div class="form-row">
      <div class="form-group col-md-6">
        <label>Min Font Size (pt)</label>
        <input class="form-control" type="number" id="preset3_min" value="10.5" min="0" step="0.5" />
      </div>
      <div class="form-group col-md-6">
        <label>Max Font Size (pt)</label>
        <input class="form-control" type="number" id="preset3_max" value="12" min="0" step="0.5" />
      </div>
    </div>
  </div>

  <div class="preset-group">
    <div class="form-group">
      <label>Textbox Name</label>
      <input class="form-control" type="text" id="preset4_name" value="#Full_Body_Content" />
    </div>
    <div class="form-row">
      <div class="form-group col-md-6">
        <label>Min Font Size (pt)</label>
        <input class="form-control" type="number" id="preset4_min" value="6" min="0" step="0.5" />
      </div>
      <div class="form-group col-md-6">
        <label>Max Font Size (pt)</label>
        <input class="form-control" type="number" id="preset4_max" value="11" min="0" step="0.5" />
      </div>
    </div>
  </div>
</div>

<div class="progress-container" style="display: none;">
  <div class="progress-status" id="progress-status">Processing...</div>
  <div class="progress">
    <div class="progress-bar" role="progressbar" style="width: 0%;" id="progress-bar"></div>
  </div>
</div>

<script>
// Function to update UI based on selected option
function updateUI() {
    const selectedOption = document.querySelector('input[name="autoresizeoptions"]:checked').id;
    
    // Hide all sections by default
    document.querySelector('.list-select-presets').style.display = 'none';
    document.querySelector('.textbox-names-container').style.display = 'none';
    document.querySelector('.font-size-constraints').style.display = 'block';
    
    // Show the appropriate section based on selection
    if (selectedOption === 'list-select') {
        document.querySelector('.list-select-presets').style.display = 'block';
        document.querySelector('.font-size-constraints').style.display = 'none';
    } else if (selectedOption === 'text') {
        document.querySelector('.textbox-names-container').style.display = 'block';
    }
}

// Run on page load
updateUI();

// Show/hide sections when option changes
document.querySelectorAll('input[name="autoresizeoptions"]').forEach(radio => {
    radio.addEventListener('change', updateUI);
});

// Function to update progress bar
function updateProgress(percent, status) {
    const progressBar = document.getElementById('progress-bar');
    const progressStatus = document.getElementById('progress-status');
    const progressContainer = document.querySelector('.progress-container');
    
    // Show progress container
    progressContainer.style.display = 'block';
    
    // Update progress bar
    progressBar.style.width = percent + '%';
    progressBar.textContent = percent + '%';
    
    // Update status text
    if (status) {
        progressStatus.textContent = status;
    }
    
    // If complete, hide after a delay
    if (percent >= 100) {
        setTimeout(() => {
            progressContainer.style.display = 'none';
            // Re-enable the resize button
            document.getElementById('resize').disabled = false;
        }, 2000);
    }
}

// Listen for messages from the plugin
window.onmessage = (event) => {
    const message = event.data.pluginMessage;
    
    if (message && message.type === 'progress-update') {
        updateProgress(message.percent, message.status);
    }
};

document.getElementById('resize').onclick = () => {
    // Disable the resize button while processing
    document.getElementById('resize').disabled = true;
    
    // Show progress bar at 0%
    updateProgress(0, 'Starting...');
    
    const resizeType = document.querySelector('input[name="autoresizeoptions"]:checked').id;
    
    if (resizeType === 'list-select') {
        // Process all four list-select presets
        const presets = [
            {
                name: document.getElementById('preset1_name').value,
                minFontSize: parseFloat(document.getElementById('preset1_min').value) || null,
                maxFontSize: parseFloat(document.getElementById('preset1_max').value) || null
            },
            {
                name: document.getElementById('preset2_name').value,
                minFontSize: parseFloat(document.getElementById('preset2_min').value) || null,
                maxFontSize: parseFloat(document.getElementById('preset2_max').value) || null
            },
            {
                name: document.getElementById('preset3_name').value,
                minFontSize: parseFloat(document.getElementById('preset3_min').value) || null,
                maxFontSize: parseFloat(document.getElementById('preset3_max').value) || null
            },
            {
                name: document.getElementById('preset4_name').value,
                minFontSize: parseFloat(document.getElementById('preset4_min').value) || null,
                maxFontSize: parseFloat(document.getElementById('preset4_max').value) || null
            }
        ];
        
        parent.postMessage({ pluginMessage: { 
            type: resizeType,
            presets: presets
        } }, '*');
    } else {
        // Process normal selection or text options
        const textIds = document.getElementById('ids').value;
        const minFontSize = parseFloat(document.getElementById('minFontSize').value) || null;
        const maxFontSize = parseFloat(document.getElementById('maxFontSize').value) || null;
        
        parent.postMessage({ pluginMessage: { 
            type: resizeType, 
            textIds: textIds,
            minFontSize: minFontSize,
            maxFontSize: maxFontSize
        } }, '*');
    }
}
    
document.getElementById('cancel').onclick = () => {
    parent.postMessage({ pluginMessage: { type: 'cancel' } }, '*');
}

</script>
